---
title: "prompt analysis"
output:
  pdf_document: default
  html_document: default
date: '2024-10-09'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lme4)
library(multcomp)
```

# Data reformatting

```{r}
data.raw = read.csv('llama3p1_8b_base.csv',header=TRUE)

canonical <- c("string","list","integer","dictionary","key","loop_through","parameter","take","provide","return","append","skip", "typecast",  "concatenate")

data <- data.raw %>% mutate(difference = pass1_intervened-pass1_original,
                            Term = ifelse(intervention %in% canonical,"Standard","Others"))
```

```{r}
sum <- data %>% group_by(intervention_category,Term) %>% summarize(meanDifference = mean(difference),
                                                                   Lemma = unique(str_to_title(ifelse(intervention_category=="loop_through","loop through",ifelse(intervention_category=="insert","append",intervention_category)))))
sum
```

```{r}
sum$Lemma <- factor(sum$Lemma,levels=c("Dictionary","Key","Integer","List","String","Parameter","Provide","Take","Loop Through","Return","Append","Concatenate","Skip","Typecast"))
ggplot(data=sum,aes(y=meanDifference,x=Lemma,fill=Term)) + geom_col(position="dodge2") + ylim(-0.1,0.1)  + theme(text=element_text(size=16),legend.position="bottom",axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
ggsave("lexical_effects.pdf",width=10,height=4)
```
